<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>C5X - V21.0 MULTI-CHANNEL</title>
    <meta name="theme-color" content="#0b0e11">
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="icon.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@500;700&family=Inter:wght@500;700;800&family=JetBrains+Mono:wght@500;700;800&family=Montserrat:wght@500;700;900&family=Nunito:wght@600;800&family=Orbitron:wght@600;900&family=Outfit:wght@500;700;900&family=Rajdhani:wght@500;600;700;800&family=Roboto+Mono:wght@500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <style>
        /* ESTILOS RESTAURADOS V19 */
        :root { --bg: #0b0e11; --surface: #151a21; --surface-glass: rgba(21, 26, 33, 0.98); --card-bg: rgba(255, 255, 255, 0.03); --text-primary: #eaecef; --text-secondary: #848e9c; --text-tertiary: #5e6673; --brand: #3b82f6; --long: #0ecb81; --short: #f6465d; --warning: #f0b90b; --danger: #cf304a; --border: #2b3139; --radius-m: 16px; --gold-fixed: #f0b90b; --chart-bg: #000000; --safe-top: env(safe-area-inset-top, 20px); --safe-bottom: env(safe-area-inset-bottom, 20px); --skeleton: rgba(255,255,255,0.05); --font-main: 'Rajdhani', sans-serif; --font-num: 'JetBrains Mono', monospace; --font-head: 'Orbitron', sans-serif; }
        body.theme-nature { --bg: #021208; --surface: #0a1f12; --brand: #2ecc71; --border: #143822; } body.theme-ocean { --bg: #030712; --surface: #0f172a; --brand: #3b82f6; --border: #1e293b; } body.theme-sunset { --bg: #1c0802; --surface: #2b1106; --brand: #f97316; --border: #52200b; } body.theme-cyber { --bg: #000000; --surface: #111111; --brand: #fbbf24; --border: #333333; } body.theme-amethyst { --bg: #10041c; --surface: #1e0b33; --brand: #d946ef; --border: #4c1d6e; } body.light-mode { --bg: #f8fafc !important; --surface: #ffffff !important; --card-bg: #f1f5f9 !important; --text-primary: #0f172a !important; --border: #e2e8f0 !important; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; } body { font-family: var(--font-main); font-weight: 600; background: var(--bg); color: var(--text-primary); padding-top: var(--safe-top); padding-bottom: calc(20px + var(--safe-bottom)); overflow-x: hidden; user-select: none; font-size: 16px; overscroll-behavior-y: none; transition: background 0.3s ease, color 0.3s ease; }
        .anim-click:active { transform: scale(0.95); } .anim-pulse { animation: pulse-ring 2s infinite; } @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } } @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } } @keyframes slide-in { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .skeleton-box { background: linear-gradient(90deg, var(--skeleton) 25%, var(--card-bg) 50%, var(--skeleton) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; color: transparent !important; } svg { fill: none; stroke: currentColor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 1.5; pointer-events: none; }
        #toast { visibility: hidden; width: 90%; max-width: 400px; background-color: var(--surface); border: 1px solid var(--border); color: var(--text-primary); text-align: center; border-radius: 12px; padding: 16px; position: fixed; z-index: 9999; left: 50%; top: -100px; transform: translateX(-50%); font-weight: 700; font-size: 14px; font-family: var(--font-head); box-shadow: 0 10px 30px rgba(0,0,0,0.5); transition: top 0.4s, opacity 0.4s; opacity: 0; } #toast.show { top: calc(10px + var(--safe-top)); visibility: visible; opacity: 1; } #toast.alert-mode { background-color: rgba(207, 48, 74, 0.98); color: #fff; border: 1px solid #ff4d4d; } #toast.success-mode { background-color: rgba(14, 203, 129, 0.98); color: #fff; border: 1px solid #0ecb81; }
        .fixed-header { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; background: var(--surface-glass); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); padding-top: var(--safe-top); } .app-header { display: flex; justify-content: space-between; align-items: center; height: 50px; padding: 0 16px; max-width: 800px; margin: 0 auto; } .brand-btn { display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 5px; } .brand-text { font-family: var(--font-head); font-weight: 900; font-size: 24px; color: var(--brand); }
        .ticker-container { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; gap: 8px; } .ticker-pill { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 4px 12px; border-radius: 24px; height: 32px; } .ticker-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-secondary); transition: background 0.3s; } .ticker-dot.pulse { animation: pulse-ring 1.5s infinite; } .ticker-price { font-family: var(--font-num); font-weight: 800; font-size: 16px; color: var(--text-primary); } .pin-btn { width: 30px; height: 30px; border-radius: 50%; background: transparent; border: 1px solid transparent; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); } .pin-btn.pinned { color: var(--brand); background: rgba(59, 130, 246, 0.1); } .theme-btn { width: 36px; height: 36px; border-radius: 50%; background: transparent; border: 1px solid var(--border); color: var(--text-primary); display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .content-spacer { margin-top: 92px; max-width: 800px; margin-left: auto; margin-right: auto; padding: 0 4px; } .app-section { display: none; opacity: 0; transition: opacity 0.2s ease; } .app-section.active { display: block; opacity: 1; animation: slide-in 0.3s ease-out; }
        .tf-bar { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; padding: 4px 12px 8px 12px; border-bottom: 1px solid var(--border); } .tf-btn { background: transparent; border: none; color: var(--text-tertiary); padding: 4px 0; font-size: 12px; font-weight: 700; border-radius: 8px; transition: all 0.2s; } .tf-btn.active { color: var(--brand); background: rgba(59, 130, 246, 0.1); font-weight: 800; }
        .slot-nav { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; padding: 8px 10px; position: sticky; top: calc(90px + var(--safe-top)); z-index: 900; background: var(--bg); border-bottom: 1px solid var(--border); margin-bottom: 10px; } .slot-card { background: transparent; color: var(--text-tertiary); padding: 10px 0; text-align: center; font-size: 14px; font-weight: 700; border-radius: 8px; position: relative; transition: all 0.3s; } .slot-card.active { color: var(--text-primary); background: rgba(255,255,255,0.02); font-weight: 800; } .slot-card.active::after { content: ''; position: absolute; bottom: 0; left: 25%; right: 25%; height: 3px; background: var(--brand); border-radius: 3px 3px 0 0; } .slot-card.has-profit:not(.active)::before { content: '‚Ä¢'; position: absolute; bottom: 2px; left: 0; right: 0; color: var(--long); font-size: 14px; line-height: 0; }
        .chart-wrapper { height: 280px; background: var(--chart-bg); margin: 0 10px; border-radius: var(--radius-m); border: 1px solid var(--border); overflow: hidden; position: relative; } .chart-wrapper.fullscreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5000; margin: 0; border-radius: 0; border: none; padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); background: var(--bg); } .chart-fs-btn { position: absolute; bottom: 10px; right: 10px; z-index: 20; width: 30px; height: 30px; background: rgba(128,128,128,0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: var(--text-primary); backdrop-filter: blur(4px); }
        .controls-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 10px; } .input-group { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius-m); padding: 8px; text-align: center; transition: border-color 0.3s; } .input-group:focus-within { border-color: var(--brand); } .input-label { font-size: 10px; color: var(--text-secondary); font-weight: 700; text-transform: uppercase; display: block; margin-bottom: 2px; } .input-field { width: 100%; background: transparent; border: none; color: var(--text-primary); font-family: var(--font-num); font-size: 15px; font-weight: 700; text-align: center; }
        .dashboard-card { background: var(--surface); border: 1px solid var(--border); border-radius: 24px; margin: 0 10px 15px; padding: 15px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; } .dashboard-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, var(--brand), var(--long)); }
        
        .wallet-bar { display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.2); padding:8px 12px; border-radius:12px; margin-bottom:15px; border:1px solid var(--border); cursor: pointer;} .wallet-label { display:flex; align-items:center; gap:6px; font-size:11px; font-weight:700; color:var(--text-secondary); letter-spacing:1px; } .wallet-amount { font-family:var(--font-num); font-weight:800; color:var(--text-primary); font-size:15px; }

        .radar-ticker-large { background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 16px; padding: 20px 12px; text-align: center; margin-bottom: 20px; position: relative; } .radar-status-dot { position: absolute; top: 12px; right: 12px; width: 8px; height: 8px; border-radius: 50%; background: var(--text-tertiary); box-shadow: 0 0 5px rgba(0,0,0,0.5); } .radar-status-dot.online { background: var(--long); box-shadow: 0 0 8px var(--long); } .radar-status-dot.offline { background: var(--danger); box-shadow: 0 0 8px var(--danger); } .radar-title { font-family: var(--font-head); font-size: 12px; font-weight: 900; color: var(--brand); letter-spacing: 2px; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; gap: 6px; } .radar-content { font-family: var(--font-num); font-weight: 800; font-size: 22px; color: var(--text-primary); min-height: 30px; display: flex; align-items: center; justify-content: center;}
        .main-target-box { text-align: center; margin-bottom: 10px; } .target-price { font-family: var(--font-num); font-size: 38px; font-weight: 800; color: var(--gold-fixed); line-height: 1; letter-spacing: -1.5px; }
        .control-row-three { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; padding: 0 5px; } .strat-display { flex: 1; text-align: center; font-family: var(--font-head); font-weight: 900; font-size: 11px; color: var(--gold-fixed) !important; letter-spacing: 1px; padding: 12px; border-radius: 12px; border: 1px solid transparent; } .strat-display.aggressive { background: rgba(240, 185, 11, 0.1); border-color: rgba(240, 185, 11, 0.2); } .icon-sq-btn { width: 42px; height: 42px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; color: var(--text-secondary); cursor: pointer; } .icon-sq-btn.locked { color: var(--danger); border-color: var(--danger); background: rgba(207, 48, 74, 0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; } .stat-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 10px 4px; text-align: center; } .stat-label { font-size: 10px; color: var(--text-tertiary); font-weight: 700; text-transform: uppercase; margin-bottom: 4px; } .stat-value { font-family: var(--font-num); font-size: 15px; font-weight: 600; color: var(--text-primary); letter-spacing: 0.5px; }
        .levels-container { padding: 0 10px; display: flex; flex-direction: column; gap: 8px; padding-bottom: 40px; } .unified-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius-m); padding: 0 12px; display: grid; grid-template-columns: 44px 1fr auto; gap: 12px; align-items: center; cursor: pointer; transition: transform 0.1s ease, background 0.2s ease, border-color 0.3s; position: relative; overflow: hidden; min-height: 72px; height: 72px; } .unified-card:active { transform: scale(0.98); } .unified-card.active { border-color: var(--brand); background: rgba(59, 130, 246, 0.08); } .u-index { width: 36px; height: 36px; border-radius: 50%; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--brand); display: flex; align-items: center; justify-content: center; font-family: var(--font-head); font-weight: 900; color: var(--brand); font-size: 12px; } .u-center { display: flex; flex-direction: column; justify-content: center; overflow: hidden; } .u-title { font-family: var(--font-num); font-size: 21px; font-weight: 700; color: var(--text-primary); line-height: 1; } .u-sub { font-size: 11px; font-weight: 600; color: var(--text-tertiary); margin-top: 2px; text-transform: uppercase; } .u-right { text-align: right; display: flex; flex-direction: column; justify-content: center; gap: 2px; flex-shrink: 0; } .u-val-primary { font-family: var(--font-num); font-size: 15px; font-weight: 800; color: var(--long); } .u-val-secondary { font-size: 11px; color: var(--text-secondary); font-weight: 700; } .liquidate-card { background: var(--danger); color: #fff; justify-content: center; font-family: var(--font-head); font-weight: 900; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(207, 48, 74, 0.4); border: none; padding: 20px; border-radius: var(--radius-m); margin-top: 10px; cursor: pointer; display: flex; align-items: center; gap:10px; }
        .setting-section-title { padding: 5px 5px; font-family: var(--font-head); color: var(--text-secondary); font-size: 12px; font-weight: 900; letter-spacing: 1px; display:flex; align-items:center; gap:8px; margin-top: 5px; } .settings-grid { display: flex; flex-direction: column; gap: 8px; } .setting-card-item { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius-m); padding: 16px; display: flex; flex-direction: column; gap: 5px; transition: background 0.3s, border-color 0.3s; } .setting-label { font-size: 11px; color: var(--text-secondary); font-weight: 700; text-transform: uppercase; } .setting-input { width: 100%; background: transparent; border: none; color: var(--text-primary); font-family: var(--font-num); font-size: 18px; font-weight: 700; border-bottom: 1px solid var(--border); } .input-row-save { display: flex; align-items: center; gap: 10px; width: 100%; } .btn-save-mini { background: var(--brand); color: #fff; border: none; width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        .data-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; } .btn-data { background: var(--surface); border: 1px solid var(--border); color: var(--text-primary); padding: 12px; border-radius: 10px; font-size: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; } .btn-reset { background: rgba(207, 48, 74, 0.1); color: var(--danger); border: 1px solid var(--danger); padding: 12px 20px; border-radius: 10px; font-weight: 900; width: 100%; margin-top: 10px; font-family: var(--font-head); cursor: pointer; display:flex; align-items:center; justify-content:center; gap:8px; } .chip-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; } .chip { background: rgba(59, 130, 246, 0.1); border: 1px solid var(--border); border-radius: 20px; padding: 6px 12px; font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px; color: var(--text-primary); } .chip-del { cursor: pointer; width: 16px; height: 16px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--text-secondary); }
        .multi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 5px; } .multi-item { background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 8px; padding: 5px; text-align: center; } .multi-lbl { font-size: 9px; color: var(--text-tertiary); display: block; font-weight: 700; } .multi-inp { width: 100%; background: transparent; border: none; color: var(--brand); font-family: var(--font-num); font-weight: 800; font-size: 14px; text-align: center; }
        #navModal, .generic-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 2000; display: none; justify-content: center; align-items: center; padding-top: var(--safe-top); } .nav-content { background: var(--surface); width: 85%; max-width: 320px; border-radius: 30px; padding: 35px 25px; border: 1px solid var(--border); box-shadow: 0 30px 60px rgba(0,0,0,0.6); display: flex; flex-direction: column; gap: 15px; } .nav-title { font-family: var(--font-head); font-size: 18px; margin-bottom: 10px; color: var(--brand); text-align: center; font-weight: 900; letter-spacing: 2px; } .nav-item { display: flex; align-items: center; padding: 20px; border-radius: 18px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); cursor: pointer; transition: 0.3s; } .nav-item.selected { background: rgba(59, 130, 246, 0.1); border-color: var(--brand); box-shadow: 0 5px 20px rgba(59, 130, 246, 0.15); } .nav-icon { width: 40px; height: 40px; margin-right: 20px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); } .nav-item.selected .nav-icon { color: var(--brand); } .nav-text { font-family: var(--font-head); font-weight: 700; font-size: 14px; letter-spacing: 1px; color: var(--text-primary); } .btn-close-menu { margin-top: 10px; width: 100%; padding: 16px; border-radius: 16px; border: 1px solid var(--border); background: var(--surface); color: var(--danger); font-family: var(--font-head); font-weight: 900; font-size: 13px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .modal-box { background: var(--surface); width: 85%; max-width: 300px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); text-align: center; } .btn-modal { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: 700; margin-bottom: 8px; cursor: pointer; } .btn-confirm { background: var(--brand); color: #fff; } .btn-cancel { background: transparent; color: var(--text-secondary); } .modal-inp { width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 12px; border-radius: 10px; color: var(--text-primary); font-size: 24px; letter-spacing: 5px; text-align: center; margin: 20px 0; font-family: var(--font-num); monospace; } .equity-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 14px; } .equity-val { font-family: var(--font-num); font-weight: 800; color: var(--text-primary); } .equity-total { border-top: 1px solid var(--border); padding-top: 15px; margin-top: 10px; color: var(--brand); font-size: 18px; }
        .log-header-bar { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 5px 16px 10px 16px; } .log-title { margin-bottom: 5px; font-family: var(--font-head); font-weight: 900; letter-spacing: 1px; color:var(--brand); } .log-actions { display: flex; gap: 15px; width: 100%; justify-content: center; }
        .stats-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; margin: 0 10px 15px; padding: 15px; } .stats-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; } .stats-title { font-family: var(--font-head); font-size: 12px; font-weight: 900; color: var(--brand); letter-spacing: 1px; } .stats-toggles { display: flex; gap: 5px; background: rgba(0,0,0,0.2); padding: 3px; border-radius: 8px; border: 1px solid var(--border); } .stat-btn { background: transparent; border: none; color: var(--text-tertiary); font-size: 10px; font-weight: 800; padding: 4px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s; } .stat-btn.active { background: var(--brand); color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .chart-box { height: 160px; display: flex; align-items: flex-end; justify-content: space-between; gap: 4px; padding-bottom: 5px; border-bottom: 1px solid var(--border); margin-bottom: 10px; position: relative; } .chart-bar { flex: 1; min-width: 4px; border-radius: 2px 2px 0 0; position: relative; transition: height 0.5s ease; animation: grow-up 0.5s ease-out; } .chart-bar.win { background: linear-gradient(to top, rgba(16,203,129,0.3), var(--long)); } .chart-bar.loss { background: linear-gradient(to top, rgba(246,70,93,0.3), var(--short)); } .chart-bar:hover { opacity: 0.8; } .chart-bar::after { content: attr(data-val); position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 9px; font-family: var(--font-num); color: var(--text-primary); opacity: 0; transition: 0.2s; pointer-events: none; white-space: nowrap; } .chart-bar:hover::after { opacity: 1; top: -20px; }
        .stats-summary { display: flex; justify-content: space-between; align-items: center; font-size: 12px; } .sum-label { color: var(--text-tertiary); font-weight: 700; margin-right: 5px; } .sum-val { font-family: var(--font-num); font-weight: 800; color: var(--text-primary); }
        #logGrid { max-height: 395px; overflow-y: auto; overscroll-behavior: contain; border-bottom: 1px solid var(--border); margin-bottom: 20px; padding-right: 2px; } #logGrid::-webkit-scrollbar { width: 4px; } #logGrid::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        .theme-grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding-bottom: 5px; } .theme-card { background: rgba(255,255,255,0.03); border: 2px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; padding: 15px 5px; } .theme-card.active { border-color: var(--brand); background: rgba(59, 130, 246, 0.1); } .theme-preview-bubble { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; font-size: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1); } .theme-name-label { font-size: 9px; font-weight: 800; color: var(--text-secondary); font-family: var(--font-head); letter-spacing: 1px; }
        .etf-search-box { position: relative; margin: 5px 10px 10px 10px; } .etf-search-input { width: 100%; background: var(--card-bg); border: 1px solid var(--border); padding: 14px 14px 14px 45px; border-radius: var(--radius-m); color: var(--text-primary); font-family: var(--font-head); font-weight: 700; font-size: 14px; transition: border 0.3s; } .etf-search-input:focus { border-color: var(--brand); } .etf-search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary); } .etf-change-badge { padding: 6px 12px; border-radius: 8px; font-size: 16px; font-weight: 800; font-family: var(--font-num); } .etf-up { background: rgba(14, 203, 129, 0.15); color: var(--long); } .etf-down { background: rgba(246, 70, 93, 0.15); color: var(--short); } .etf-fav-icon { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; color: var(--text-tertiary); cursor: pointer; transition: 0.2s; } .etf-fav-icon.is-fav { color: var(--warning); } .etf-card-right { display: flex; align-items: center; gap: 12px; }
        
        /* SELECTOR CANALES */
        .channel-selector { width: 100%; background: var(--card-bg); border: 1px solid var(--border); color: var(--text-primary); padding: 12px; border-radius: 12px; font-family: var(--font-head); font-weight: 700; margin-bottom: 10px; appearance: none; }
        .diag-box { font-size:10px; color:var(--text-secondary); margin-top:5px; word-break:break-all; background:rgba(0,0,0,0.2); padding:5px; border-radius:6px; display:none; }
        .diag-box.active { display:block; }
    </style>
</head>
<body onload="init()">

    <audio id="alertSound" preload="auto" src="data:audio/wav;base64,UklGRl9vT1BXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"></audio>
    <div id="toast">Notificaci√≥n</div>

    <div id="navModal" onclick="if(event.target===this) closeMenuViaButton()">
        <div class="nav-content section-enter">
            <div class="nav-title">MEN√ö C5X</div>
            <div class="nav-item selected anim-click" id="nav-operate" onclick="switchView('operate')"><div class="nav-icon"><svg width="24" height="24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><div class="nav-text">OPERAR</div></div>
            <div class="nav-item anim-click" id="nav-etf" onclick="switchView('etf')"><div class="nav-icon anim-pulse"><svg width="24" height="24"><circle cx="12" cy="12" r="10"/><path d="M16.24 7.76l-2.12 2.12"/><path d="M7.76 16.24l2.12-2.12"/><line x1="12" y1="12" x2="12" y2="8"/><line x1="12" y1="12" x2="16" y2="12"/></svg></div><div class="nav-text">MONITOR ETF</div></div>
            <div class="nav-item anim-click" id="nav-log" onclick="switchView('log')"><div class="nav-icon"><svg width="24" height="24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></div><div class="nav-text">BIT√ÅCORA</div></div>
            <div class="nav-item anim-click" id="nav-settings" onclick="switchView('settings')"><div class="nav-icon anim-spin"><svg width="24" height="24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div><div class="nav-text">AJUSTES</div></div>
            <button class="btn-close-menu anim-click" onclick="closeMenuViaButton()"><svg width="18" height="18"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> CERRAR MEN√ö</button>
        </div>
    </div>

    <div class="fixed-header">
        <header class="app-header">
            <div class="brand-btn anim-click" onclick="openMenuViaButton()">
                <span class="brand-text">C5X</span>
                <svg width="20" height="20" style="color:var(--text-tertiary)"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </div>
            
            <div class="ticker-container"><div class="ticker-pill anim-click" onclick="viewTickerChart(event)"><div class="ticker-dot" id="t-dot"></div><span class="ticker-sym" id="t-sym">BTC</span><span class="ticker-price" id="t-price"><span class="skeleton-text skeleton-box"></span></span></div><button class="pin-btn anim-click" id="tickerPinBtn" onclick="toggleTickerPin()"><svg width="14" height="14"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg></button></div>
            
            <button class="theme-btn anim-click" onclick="toggleTheme()" id="themeBtn">üåô</button>
        </header>
        <div class="tf-bar" id="tfBarContainer">
            <button class="tf-btn anim-click" data-tf="15" onclick="updateTF('15', this)">15M</button><button class="tf-btn anim-click" data-tf="30" onclick="updateTF('30', this)">30M</button><button class="tf-btn anim-click" data-tf="60" onclick="updateTF('60', this)">1H</button><button class="tf-btn anim-click" data-tf="240" onclick="updateTF('240', this)">4H</button><button class="tf-btn anim-click" data-tf="D" onclick="updateTF('D', this)">1D</button>
        </div>
    </div>

    <div class="content-spacer">
        <div id="section-operate" class="app-section active">
            <nav id="slotNav" class="slot-nav"></nav>
            <div id="tv_chart" class="chart-wrapper"><div class="chart-fs-btn anim-click" onclick="toggleFullscreenChart(event)"><svg width="18" height="18"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg></div></div>
            <div class="controls-grid"><div class="input-group"><label class="input-label">Moneda</label><input type="text" id="coinInput" class="input-field" placeholder="BTC" oninput="forceCaps(this)" onblur="updateCoin()"></div><div class="input-group"><label class="input-label">Base</label><input type="number" id="baseInput" class="input-field" oninput="calculate()" step="any" placeholder="0.00"></div><div class="input-group readonly"><label class="input-label">Capital</label><input type="number" id="capitalInput" class="input-field" readonly></div></div>
            
            <div class="dashboard-card" id="dashMain">
                <div class="wallet-bar" onclick="fetchWalletBalance()">
                    <div class="wallet-label">
                        <svg width="14" height="14" style="color:var(--brand)"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h0M2 10h20"/><path d="M7 15h0M2 10h20M7 15h0M2 10h20"/></svg>
                        <span>SALDO GATE.IO</span>
                    </div>
                    <span id="dashWallet" class="wallet-amount">Conectando...</span>
                </div>

                <div id="radarTickerContainer" class="radar-ticker-large anim-pulse" onclick="switchView('etf', false)">
                    <div id="radarStatus" class="radar-status-dot offline"></div>
                    <div class="radar-title"><svg width="12" height="12"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg> RADAR DE OPORTUNIDADES</div>
                    <div id="radarValue" class="radar-content"><span class="skeleton-text skeleton-box" style="width:120px; height:20px;"></span></div>
                </div>
                
                <div class="main-target-box"><div class="target-label">OBJETIVO SALIDA</div><div class="target-price" id="resTarget">0.00000000</div></div>
                <div class="control-row-three">
                    <div class="icon-sq-btn anim-click" id="lockBtn" onclick="toggleLock()" title="Bloquear Slot"><svg width="18" height="18"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
                    <div class="strat-display anim-click" id="stratBadge" onclick="rotateDash()">NORMAL</div>
                    <div class="icon-sq-btn anim-click" onclick="cleanSlotOnly()" title="Limpiar Slot"><svg width="18" height="18"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
                </div>
                <div class="stats-grid"><div class="stat-box"><div class="stat-label">Promedio</div><div class="stat-value" id="resAvg">0.00000000</div></div><div class="stat-box"><div class="stat-label">Ganancia</div><div class="stat-value" id="resProfit" style="color:var(--long)">$0.00</div></div><div class="stat-box"><div class="stat-label">Inversi√≥n</div><div class="stat-value" id="resInv">$0.00</div></div></div>
            </div>
            
            <main id="levelsGrid" class="levels-container"></main>
        </div>

        <div id="section-etf" class="app-section">
            <div class="etf-search-box"><span class="etf-search-icon"><svg width="16" height="16"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span><input type="text" class="etf-search-input" placeholder="BUSCAR TOKEN (Ej: BTC, SUI)" oninput="filterETFs(this.value)"></div>
            <div id="etfGrid" class="levels-container"></div>
        </div>

        <div id="section-log" class="app-section">
            <div class="log-header-bar">
                <div class="log-title">BIT√ÅCORA</div>
                <div class="log-actions">
                    <button class="action-btn anim-click" onclick="exportPDF()"><svg width="14" height="14"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg> REPORTE</button>
                    <button class="action-btn anim-click" onclick="triggerDriveBackup()"><svg width="14" height="14"><path d="M19 18a3.5 3.5 0 0 0 0-7h-1A5 4.5 0 0 0 8 9a4.5 4.5 0 0 0-4.5 4.5c0 .4.04.79.12 1.16"/></svg> RESPALDO</button>
                    <button class="action-btn anim-click" style="color:var(--danger); border-color:var(--danger)" onclick="clearLogs()"><svg width="14" height="14"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> BORRAR</button>
                </div>
            </div>
            
            <div class="stats-card anim-click">
                <div class="stats-header">
                    <div class="stats-title">RENDIMIENTO</div>
                    <div class="stats-toggles">
                        <button class="stat-btn active" onclick="updateStats('D')">1D</button>
                        <button class="stat-btn" onclick="updateStats('W')">1S</button>
                        <button class="stat-btn" onclick="updateStats('M')">1M</button>
                        <button class="stat-btn" onclick="updateStats('A')">TODO</button>
                    </div>
                </div>
                <div class="chart-box" id="pnlChart"></div>
                <div class="stats-summary">
                    <div><span class="sum-label">NETO (FEES INC.)</span><span class="sum-val" id="chartNeto">$0.00</span></div>
                    <div><span class="sum-label">WIN RATE</span><span class="sum-val" id="chartWr">0%</span></div>
                </div>
            </div>

            <div id="logGrid" class="levels-container"></div>
        </div>

        <div id="section-settings" class="app-section">
            
            <div class="setting-section-title"><svg width="14" height="14"><circle cx="12" cy="12" r="10"/><path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83M16.62 12l-5.74 9.94"/></svg> APARIENCIA & TEMA</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                    <div class="theme-grid-container">
                        <div class="theme-card active" id="pal-default" onclick="setPalette('default')"><div class="theme-preview-bubble" style="background:#3b82f6; color:#fff">üí†</div><span class="theme-name-label">CLASSIC</span></div>
                        <div class="theme-card" id="pal-nature" onclick="setPalette('nature')"><div class="theme-preview-bubble" style="background:#22c55e; color:#fff">üåø</div><span class="theme-name-label">NATURE</span></div>
                        <div class="theme-card" id="pal-ocean" onclick="setPalette('ocean')"><div class="theme-preview-bubble" style="background:#6366f1; color:#fff">üåä</div><span class="theme-name-label">OCEAN</span></div>
                        <div class="theme-card" id="pal-sunset" onclick="setPalette('sunset')"><div class="theme-preview-bubble" style="background:#f97316; color:#fff">üåÖ</div><span class="theme-name-label">SUNSET</span></div>
                        <div class="theme-card" id="pal-cyber" onclick="setPalette('cyber')"><div class="theme-preview-bubble" style="background:#000; border:2px solid #eab308; color:#eab308">‚ö†Ô∏è</div><span class="theme-name-label">CYBER</span></div>
                        <div class="theme-card" id="pal-amethyst" onclick="setPalette('amethyst')"><div class="theme-preview-bubble" style="background:#d946ef; color:#fff">üîÆ</div><span class="theme-name-label">AMETHYST</span></div>
                        <div class="theme-card" id="pal-velvet" onclick="setPalette('velvet')"><div class="theme-preview-bubble" style="background:#f43f5e; color:#fff">üç∑</div><span class="theme-name-label">VELVET</span></div>
                        <div class="theme-card" id="pal-slate" onclick="setPalette('slate')"><div class="theme-preview-bubble" style="background:#64748b; color:#fff">üëΩ</div><span class="theme-name-label">SLATE</span></div>
                        <div class="theme-card" id="pal-aurora" onclick="setPalette('aurora')"><div class="theme-preview-bubble" style="background:#06b6d4; color:#fff">‚ùÑÔ∏è</div><span class="theme-name-label">AURORA</span></div>
                    </div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg> API & TRADING (GATE.IO)</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                    <div class="input-row-save" style="margin-bottom:10px; justify-content:space-between;">
                        <span class="setting-label">CREDENCIALES API</span>
                        <button class="btn-save-mini anim-click" onclick="saveApiKeysSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:10px">
                        <input type="password" class="setting-input" id="apiKey" placeholder="API KEY (KEY)" style="border-bottom:1px solid var(--border)">
                        <input type="password" class="setting-input" id="apiSecret" placeholder="API SECRET (SECRET)">
                    </div>
                    <div style="margin-top:10px;">
                        <label class="setting-label">CANAL DE CONEXI√ìN</label>
                        <select id="connChannel" class="channel-selector" onchange="saveChannel()">
                            <option value="direct">DIRECTO (KIWI + EXTENSI√ìN)</option>
                            <option value="proxy1">PUENTE A (CORSPROXY.IO)</option>
                            <option value="proxy2">PUENTE B (ALLORIGINS)</option>
                        </select>
                    </div>
                    <button class="btn-data anim-click" style="width:100%" onclick="runConnectionTest()">üõ†Ô∏è PROBAR CONEXI√ìN</button>
                    <div id="diagResult" class="diag-box"></div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg> CAPITAL & RENDIMIENTO</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                    <div class="input-row-save" style="margin-bottom:10px;">
                        <span class="setting-label" style="flex:1">CAPITAL TOTAL BASE ($)</span>
                        <button class="btn-save-mini anim-click" onclick="saveGlobalCapSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                        <input type="number" class="setting-input" id="setGlobalCapital" placeholder="0.00" style="border-bottom:1px solid var(--border)">
                        <div><label class="setting-label">COMISI√ìN EXCHANGE (%)</label><input type="number" class="setting-input" id="setFee" placeholder="0.1" step="0.01"></div>
                    </div>
                </div>
                <div class="setting-card-item">
                    <label class="setting-label">GANANCIA MES ACTUAL</label>
                    <div id="monthlyProfitDisplay" style="font-family:var(--font-num); font-size:16px; font-weight:800; color:var(--text-primary);">$0.00 <span style="font-size:12px; color:var(--text-tertiary)">(0%)</span></div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> ESTRATEGIA Y GESTI√ìN</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                    <div class="input-row-save" style="margin-bottom:10px; justify-content:space-between;">
                        <span class="setting-label">CONFIGURACI√ìN SLOT ACTUAL</span>
                        <button class="btn-save-mini anim-click" onclick="saveSlotParamsSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <div><label class="setting-label">CAPITAL ($)</label><input type="number" class="setting-input" id="setCapital"></div>
                        <div><label class="setting-label">ROI (%)</label><input type="number" class="setting-input" id="setRoi" placeholder="100"></div>
                        <div><label class="setting-label">INC. BASE (%)</label><input type="number" class="setting-input" id="setInc"></div>
                        <div><label class="setting-label">AGRESIVO (%)</label><input type="number" class="setting-input" id="setDesc"></div>
                        <div><label class="setting-label">DD MAX (%)</label><input type="number" class="setting-input" id="setDD" placeholder="10"></div>
                    </div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg> AJUSTES AVANZADOS</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                     <div class="input-row-save" style="justify-content:space-between; margin-bottom:5px;">
                        <span class="setting-label">RADAR & TICKER</span>
                        <button class="btn-save-mini anim-click" onclick="saveRadarSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
                        <div><label class="setting-label">ITEMS</label><input type="number" class="setting-input" id="setRadarLimit" placeholder="8"></div>
                        <div><label class="setting-label">VEL. RADAR</label><input type="number" class="setting-input" id="setRadarSpeed" placeholder="5"></div>
                        <div><label class="setting-label">VEL. TICKER</label><input type="number" class="setting-input" id="setTickerSpeed" placeholder="7"></div>
                    </div>
                </div>
                
                <div class="setting-card-item">
                    <div class="input-row-save" style="justify-content:space-between; margin-bottom:5px;">
                        <span class="setting-label">MULTIPLICADORES</span>
                        <button class="btn-save-mini anim-click" onclick="saveMultiSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                    </div>
                    <div id="multiGrid" class="multi-grid"></div>
                </div>

                <div class="setting-card-item">
                    <label class="setting-label">MONEDAS DEL TICKER</label>
                    <div id="tickerChipsContainer" class="chip-container"></div>
                    <div class="add-coin-row"><div class="input-wrapper" style="flex:1"><input type="text" id="newTickerCoin" placeholder="A√ëADIR (ej: PEPE)" oninput="forceCaps(this)" onkeypress="handleEnter(event)" style="border:none; background:transparent; color:var(--text-primary); font-family:var(--font-num); font-weight:700;"></div><button id="addCoinBtn" class="btn-data anim-click" style="width:auto; padding:5px 15px; margin:0;" onclick="verifyAndAddCoin()">A√ëADIR</button></div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> SEGURIDAD</div>
            <div class="settings-grid">
                <div class="setting-card-item">
                     <div class="input-row-save">
                        <div style="flex:1"><label class="setting-label">NUEVA CLAVE</label><input type="password" class="setting-input" id="setNewPass" placeholder="****" maxlength="4" style="letter-spacing:4px;"></div>
                        <button class="btn-save-mini anim-click" onclick="savePassSecure()"><svg width="18" height="18"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg></button>
                     </div>
                </div>
            </div>

            <div class="setting-section-title"><svg width="14" height="14"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> GESTI√ìN DE DATOS</div>
            <div class="data-actions"><button class="btn-data anim-click" onclick="exportData()">‚¨áÔ∏è EXPORTAR BACKUP</button><button class="btn-data anim-click" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è IMPORTAR BACKUP</button><input type="file" id="importFile" style="display:none" onchange="importData(this)"></div>
            <button class="btn-reset anim-click" style="margin-top:15px; border-color:var(--border); color:var(--text-secondary); background:transparent;" onclick="clearLogs()"><svg width="14" height="14"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> BORRAR HISTORIAL</button>
            <button class="btn-reset anim-click" style="margin-top:5px; border-color:var(--border); color:var(--text-secondary); background:transparent;" onclick="clearCrashMemory()"><svg width="14" height="14"><path d="M18 6L6 18M6 6l12 12"/></svg> RESETEAR ALERTAS CRASH</button>

            <div class="settings-card danger" style="margin-top:20px; border:1px solid var(--danger); background:rgba(207, 48, 74, 0.05); border-radius:16px; padding:15px;">
                <div class="setting-header" style="color:var(--danger); border-bottom:1px solid rgba(207, 48, 74, 0.3); padding-bottom:10px; margin-bottom:10px; font-weight:800;">‚ö†Ô∏è ZONA CR√çTICA</div>
                <div class="setting-info" style="text-align:center; margin-bottom:10px; font-size:12px; color:var(--text-secondary);"><p>Restablecer la aplicaci√≥n borrar√° TODOS los datos, slots y configuraciones.</p></div>
                <button class="btn-reset anim-click" onclick="resetApp()"><svg width="14" height="14"><path d="M2.5 2v6h6M21.5 22v-6h-6"/><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"/></svg> RESTABLECER DE F√ÅBRICA</button>
            </div>
            <div style="text-align:center; font-size:10px; color:var(--text-tertiary); margin-top:20px; font-weight:700; letter-spacing:1px; margin-bottom:40px;">C5X V20.2 FINAL</div>
        </div>
    </div>

    <div id="tradeModal" class="generic-modal">
        <div class="modal-box section-enter">
            <div class="nav-title" style="color:var(--brand); margin-bottom:10px;">EJECUTAR ORDEN</div>
            <div class="modal-info-text">Est√°s a punto de enviar una orden real a Gate.io</div>
            
            <div class="trade-details">
                <div>PAR: <span id="trade-pair" style="color:var(--text-primary); font-weight:800">BTC_USDT</span></div>
                <div>PRECIO: <span id="trade-price" style="color:var(--text-primary); font-weight:800">0.00</span></div>
                <div>CANTIDAD: <span id="trade-amount" style="color:var(--text-primary); font-weight:800">0.00</span></div>
                <div>TOTAL: <span id="trade-total" style="color:var(--long); font-weight:800">$0.00</span></div>
            </div>

            <button class="btn-modal btn-confirm anim-click" onclick="executeGateOrder()">CONFIRMAR COMPRA</button>
            <button class="btn-modal btn-cancel anim-click" onclick="closeModals()">CANCELAR</button>
        </div>
    </div>

    <div id="confirmModal" class="generic-modal"><div class="modal-box section-enter"><div style="font-family:'Orbitron'; font-size:14px; margin-bottom:15px; color:var(--danger)">¬øLIQUIDAR POSICI√ìN?</div><p style="font-size:12px; color:var(--text-secondary); margin-bottom:20px;">Esta acci√≥n cerrar√° el slot actual y guardar√° el registro.</p><button class="btn-modal btn-confirm anim-click" style="background:var(--danger)" onclick="executeRelease()">S√ç, LIQUIDAR</button><button class="btn-modal btn-cancel anim-click" onclick="closeModals()">CANCELAR</button></div></div>
    <div id="securityModal" class="generic-modal"><div class="modal-box section-enter"><div style="font-family:'Orbitron'; font-size:12px;">SEGURIDAD</div><input type="password" id="secInput" class="modal-inp" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric" pattern="[0-9]*"><button class="btn-modal btn-confirm anim-click" onclick="validateSecurity()">VALIDAR</button><button class="btn-modal btn-cancel anim-click" onclick="closeModals()">CANCELAR</button></div></div>
    <input type="hidden" id="incInput" value="7"><input type="hidden" id="descInput" value="66">

    <script>
        // --- INICIO Y CONFIG ---
        let isLight = localStorage.getItem('theme') === 'light';
        let currentPalette = localStorage.getItem('c5x_palette') || 'default';
        let activeIdx = parseInt(localStorage.getItem('c5x_last_slot')) || 0;
        let activeTF = localStorage.getItem('c5x_last_tf') || '60';
        let chartSymbol = '';
        let history = JSON.parse(localStorage.getItem('c5x_history')) || [];
        let slots = JSON.parse(localStorage.getItem('dca_v18_slots')) || Array(5).fill(null).map(() => ({ name:'', price:0, capital:5, buys:[], strat:'normal', locked: true, roi: 100 }));
        if(slots.length < 5) while(slots.length < 5) slots.push({ name:'', price:0, capital:5, buys:[], strat:'normal', locked: true, roi: 100 });
        let customMultipliers = JSON.parse(localStorage.getItem('c5x_multipliers')) || [1.0, 1.0, 1.5, 1.5, 2.0, 2.0, 5.0, 5.0, 8.0, 8.0, 16.0, 16.0];
        let apiConfig = JSON.parse(localStorage.getItem('c5x_api_keys')) || { key: '', secret: '' };
        let appConfig = JSON.parse(localStorage.getItem('c5x_config')) || { pin: '2524', dd: 10 };
        let globalCapital = parseFloat(localStorage.getItem('c5x_global_capital')) || 0; 
        let exchangeFee = parseFloat(localStorage.getItem('c5x_fee')) || 0.1;
        let tickerAssets = JSON.parse(localStorage.getItem('c5x_ticker_assets')) || ["BTC", "ETH", "SUI", "AVAX", "SOL"]; 
        let assetIdx = 0; let currentTickerSymbol = "BTC";
        let radarLimit = 8; let radarSpeed = 5; 
        let allGateETFs = []; let topDroppers = []; let dropperIdx = 0; let radarIntervalId = null; let tickerIntervalId = null;
        let etfFavorites = JSON.parse(localStorage.getItem('c5x_etf_favorites')) || [];
        let serverTimeOffset = 0;
        
        // --- NUEVO: SELECTOR DE CANALES ---
        let currentChannel = localStorage.getItem('c5x_channel') || 'direct';

        function init() { 
            try {
                if(isLight) document.body.classList.add('light-mode');
                applyPalette(currentPalette);
                renderNav(); selectSlot(activeIdx);
                document.querySelectorAll('.tf-btn').forEach(btn => { if(btn.dataset.tf === activeTF) btn.classList.add('active'); });
                
                // Setear selector
                const sel = document.getElementById('connChannel');
                if(sel) sel.value = currentChannel;

                syncTimeAndBalance();
                startTickerSystem();
                fetchAndCalcTopDroppers(); // Radar FIX

            } catch(e) { console.error("Init Error", e); }
        }

        function saveChannel() {
            currentChannel = document.getElementById('connChannel').value;
            localStorage.setItem('c5x_channel', currentChannel);
            showToast("Canal cambiado: " + currentChannel.toUpperCase());
            fetchWalletBalance();
        }

        async function syncTimeAndBalance() {
            try {
                const start = Date.now();
                const res = await fetch("https://api.gateio.ws/api/v4/spot/time", { cache: "no-store" });
                if(res.ok) {
                    const data = await res.json();
                    serverTimeOffset = (data.server_time * 1000) - (start + ((Date.now() - start) / 2));
                }
            } catch(e) {}
            fetchWalletBalance();
        }

        // ==========================================
        // üõ°Ô∏è MOTOR V20.2: MULTI-CHANNEL
        // ==========================================
        async function callGateApi(method, path, queryParams = "", body = null) {
            // FIX RADAR: Si es p√∫blico, NO enviar claves para evitar bloqueo OPTIONS
            const isPublic = path.includes('tickers') || path.includes('time') || path.includes('candlesticks');

            if (!isPublic && (!apiConfig.key || !apiConfig.secret)) {
                 throw new Error("Faltan API Keys");
            }

            const host = "https://api.gateio.ws";
            const prefix = "/api/v4";
            const url = prefix + path;
            const timestamp = Math.floor((Date.now() + serverTimeOffset) / 1000).toString();
            
            let headers = { 'Accept': 'application/json', 'Content-Type': 'application/json' };

            // Firmar solo si es privado
            if(!isPublic && apiConfig.key && apiConfig.secret) {
                const hashedPayload = body ? CryptoJS.SHA512(JSON.stringify(body)).toString(CryptoJS.enc.Hex) : CryptoJS.SHA512("").toString(CryptoJS.enc.Hex);
                const signatureString = `${method}\n${url}\n${queryParams}\n${hashedPayload}\n${timestamp}`;
                const signature = CryptoJS.HmacSHA512(signatureString, apiConfig.secret).toString(CryptoJS.enc.Hex);
                headers['KEY'] = apiConfig.key; headers['Timestamp'] = timestamp; headers['SIGN'] = signature;
            }

            const fullUrl = queryParams ? `${host}${url}?${queryParams}` : `${host}${url}`;
            
            // SELECCI√ìN DE ESTRATEGIA SEG√öN CANAL
            try {
                if(currentChannel === 'direct') {
                    // Intento Directo (Kiwi + Extensi√≥n)
                    const res = await fetch(fullUrl, { method: method, headers: headers, body: body ? JSON.stringify(body) : null });
                    if(res.ok) return await res.json();
                    if(res.status === 401 || res.status === 403) throw new Error("Error Auth " + res.status);
                    throw new Error("Direct Fail");

                } else if (currentChannel === 'proxy1') {
                    // CorsProxy.io
                    const pUrl = "https://corsproxy.io/?" + encodeURIComponent(fullUrl);
                    const res = await fetch(pUrl, { method: method, headers: headers, body: body ? JSON.stringify(body) : null });
                    if(res.ok) return await res.json();
                    throw new Error("Proxy1 Fail");

                } else if (currentChannel === 'proxy2') {
                    // AllOrigins (Solo GET usualmente, pero √∫til para saldo)
                    const pUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(fullUrl);
                    const res = await fetch(pUrl, { method: method, headers: headers, body: body ? JSON.stringify(body) : null });
                    if(res.ok) return await res.json();
                    throw new Error("Proxy2 Fail");
                }
            } catch(e) {
                throw e; // Propagar error para UI
            }
            throw new Error("Canal desconocido");
        }

        async function fetchWalletBalance() {
            const elDash = document.getElementById('dashWallet');
            if(elDash) elDash.textContent = "Conectando...";

            try {
                const data = await callGateApi("GET", "/spot/accounts", "currency=USDT");
                let available = 0;
                let rows = Array.isArray(data) ? data : (data.result || []); 
                if (rows.length > 0) available = parseFloat(rows[0].available);

                globalCapital = available;
                localStorage.setItem('c5x_global_capital', globalCapital);
                
                if(elDash) {
                    elDash.textContent = "$" + available.toFixed(2);
                    elDash.style.color = "var(--text-primary)";
                }
                const elCap = document.getElementById('setGlobalCapital');
                if(elCap) elCap.value = available.toFixed(2);
                
                // Mostrar √©xito en diagnostico
                const diag = document.getElementById('diagResult');
                if(diag) { diag.classList.add('active'); diag.innerHTML = `<span style="color:var(--long)">‚úÖ Conectado por ${currentChannel.toUpperCase()}</span>`; }

            } catch (e) {
                const elDash = document.getElementById('dashWallet');
                if(elDash) {
                    elDash.textContent = "Error: " + currentChannel.toUpperCase();
                    elDash.style.color = "var(--danger)";
                }
                const diag = document.getElementById('diagResult');
                if(diag) { diag.classList.add('active'); diag.innerHTML = `<span style="color:var(--danger)">‚ùå Fallo ${currentChannel}: ${e.message}</span>`; }
            }
        }

        async function runConnectionTest() { fetchWalletBalance(); }

        // --- RESTO DE FUNCIONES (UI, ETC) ---
        function setPalette(p) { currentPalette=p; localStorage.setItem('c5x_palette', p); location.reload(); }
        function toggleTheme() { isLight=!isLight; localStorage.setItem('theme', isLight?'light':'dark'); location.reload(); }
        function saveApiKeysSecure() { reqSec(()=>{ apiConfig={key:document.getElementById('apiKey').value, secret:document.getElementById('apiSecret').value}; localStorage.setItem('c5x_api_keys', JSON.stringify(apiConfig)); showToast("API Guardada"); fetchWalletBalance(); }); }
        
        // (El resto de funciones auxiliares se mantienen igual para ahorrar espacio visual, ya que son id√©nticas a V19.0)
        let secAction=null;
        function reqSec(cb) { secAction=cb; document.getElementById('secInput').value=''; document.getElementById('securityModal').style.display='flex'; }
        function validateSecurity() { if(document.getElementById('secInput').value===appConfig.pin) { closeModals(); if(secAction) secAction(); } else showToast("PIN Error"); }
        function closeModals() { document.querySelectorAll('.generic-modal').forEach(m=>m.style.display='none'); }
        function showToast(t, time=2500, alert=false, success=false) { const el = document.getElementById("toast"); el.textContent=t; el.className="show"; if(alert) el.classList.add("alert-mode"); if(success) el.classList.add("success-mode"); setTimeout(()=>el.className="", time); }
        function saveGlobalCapSecure() { reqSec(()=>{ globalCapital=parseFloat(document.getElementById('setGlobalCapital').value); localStorage.setItem('c5x_global_capital', globalCapital); showToast("Capital Guardado"); }); }
        function saveSlotParamsSecure() { reqSec(()=>{ slots[activeIdx].capital=parseFloat(document.getElementById('setCapital').value); slots[activeIdx].roi=parseFloat(document.getElementById('setRoi').value); save(); showToast("Slot Guardado"); calculate(); }); }
        function savePassSecure() { reqSec(()=>{ const p=document.getElementById('setNewPass').value; if(p.length===4) { appConfig.pin=p; localStorage.setItem('c5x_config', JSON.stringify(appConfig)); showToast("PIN Cambiado"); } }); }
        function clearLogs() { reqSec(()=>{ history=[]; localStorage.setItem('c5x_history', JSON.stringify(history)); showToast("Historial Borrado"); }); }
        function saveRadarSecure() { reqSec(() => { radarLimit = parseInt(document.getElementById('setRadarLimit').value); radarSpeed = parseInt(document.getElementById('setRadarSpeed').value); tickerSpeed = parseInt(document.getElementById('setTickerSpeed').value); showToast("Radar Guardado"); fetchAndCalcTopDroppers(); }); }
        function saveMultiSecure() { reqSec(() => { const inputs = document.querySelectorAll('.multi-inp'); let newMultipliers = []; inputs.forEach(inp => { let val = parseFloat(inp.value); if(!isNaN(val)) newMultipliers.push(val); }); if(newMultipliers.length >= 5) { customMultipliers = newMultipliers; localStorage.setItem('c5x_multipliers', JSON.stringify(customMultipliers)); calculate(); showToast("Multiplicadores Guardados"); } }); }
        
        function selectSlot(i) { activeIdx=i; localStorage.setItem('c5x_last_slot', i); const s=slots[i]; document.getElementById('coinInput').value=s.name; document.getElementById('baseInput').value=s.price||''; document.getElementById('capitalInput').value=s.capital; renderNav(); loadChart(s.name); updateDashUI(); }
        function save() { localStorage.setItem('dca_v18_slots', JSON.stringify(slots)); }
        function renderNav() { document.getElementById('slotNav').innerHTML = slots.map((s,i)=>`<div class="slot-card ${i===activeIdx?'active':''} ${s.name?'is-occupied':''}" onclick="selectSlot(${i})">${s.name||'S'+(i+1)}</div>`).join(''); }
        function updateDashUI() { const s=slots[activeIdx]; document.getElementById('stratBadge').textContent=s.strat==="normal"?"NORMAL":"AGRESIVA"; const lk=document.getElementById('lockBtn'); lk.textContent=s.locked?"üîí":"üîì"; lk.className=s.locked?"icon-sq-btn locked":"icon-sq-btn"; calculate(); }
        function calculate() { const s=slots[activeIdx]; const p=parseFloat(document.getElementById('baseInput').value); s.price=isNaN(p)?0:p; save(); renderLevels(); }

        function loadChart(s) { if(!s) return; new TradingView.widget({ "autosize": true, "symbol": "GATEIO:"+s.replace('USDT','')+"USDT", "interval": activeTF, "theme": isLight?"light":"dark", "container_id": "tv_chart", "hide_top_toolbar": true }); }
        function updateTF(tf, btn) { activeTF=tf; document.querySelectorAll('.tf-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); loadChart(slots[activeIdx].name); }
        function toggleFullscreenChart() { document.getElementById('tv_chart').classList.toggle('fullscreen'); loadChart(slots[activeIdx].name); }
        function forceCaps(el) { el.value=el.value.toUpperCase(); }
        function updateCoin() { slots[activeIdx].name=document.getElementById('coinInput').value.toUpperCase(); save(); loadChart(slots[activeIdx].name); }
        function cleanSlotOnly() { if(confirm("¬øLimpiar?")) { slots[activeIdx].name=''; save(); selectSlot(0); } }
        function toggleLock() { slots[activeIdx].locked=!slots[activeIdx].locked; save(); updateDashUI(); }
        function rotateDash() { if(!slots[activeIdx].locked) { slots[activeIdx].strat=slots[activeIdx].strat==="normal"?"aggressive":"normal"; save(); updateDashUI(); } }
        
        function openMenuViaButton() { document.getElementById('navModal').style.display='flex'; }
        function closeMenuViaButton() { document.getElementById('navModal').style.display='none'; }
        function switchView(v) { document.getElementById('navModal').style.display='none'; document.querySelectorAll('.app-section').forEach(e=>e.classList.remove('active')); document.getElementById('section-'+v).classList.add('active'); if(v==='operate') { document.getElementById('tfBarContainer').style.display='grid'; if(chartSymbol) loadChart(chartSymbol); } else document.getElementById('tfBarContainer').style.display='none'; if(v==='etf') loadGateETFs(); if(v==='settings') loadSettingsValues(); }
        
        function loadSettingsValues() {
            document.getElementById('setGlobalCapital').value=globalCapital.toFixed(2);
            document.getElementById('apiKey').value=apiConfig.key; document.getElementById('apiSecret').value=apiConfig.secret;
            const s=slots[activeIdx]; document.getElementById('setCapital').value=s.capital; document.getElementById('setRoi').value=s.roi;
            const grid = document.getElementById('multiGrid'); 
            if(grid) grid.innerHTML = customMultipliers.map((val, i) => `<div class="multi-item"><span class="multi-lbl">N${i+1}</span><input type="number" class="multi-inp" value="${val}" step="0.1"></div>`).join('');
        }
        
        function exportPDF() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text("C5X Report", 10, 10); doc.autoTable({ head: [['Date', 'Coin', 'Profit']], body: history.map(h=>[h.date, h.coin, h.profit]) }); doc.save("report.pdf"); }
        function triggerDriveBackup() { const blob=new Blob([JSON.stringify({slots,history})], {type:"application/json"}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="backup.json"; document.body.appendChild(a); a.click(); }
        function exportData() { triggerDriveBackup(); }
        function importData(input) { const f=input.files[0]; if(!f) return; const r=new FileReader(); r.onload=e=>{ try { const d=JSON.parse(e.target.result); if(d.slots) slots=d.slots; if(d.history) history=d.history; save(); location.reload(); } catch(err){} }; r.readAsText(f); }
        function resetApp() { openSecurity(() => { localStorage.clear(); location.reload(); }); }
        function updateStats(tf) { showToast("Stats actualizados"); } // Placeholder
        function checkAutoBackup() {}
        function unlockAudioAndWake() { const audio = document.getElementById('alertSound'); if(audio) { audio.play().then(() => { audio.pause(); audio.currentTime = 0; }).catch(e=>{}); } if("Notification" in window && Notification.permission !== "granted") { Notification.requestPermission(); } requestWakeLock(); checkAutoBackup(); }
        async function requestWakeLock() { try { if ('wakeLock' in navigator) await navigator.wakeLock.request('screen'); } catch (err) {} }
        
        async function startTickerSystem() { if(tickerIntervalId) clearInterval(tickerIntervalId); updateTicker(); tickerIntervalId=setInterval(updateTicker, 7000); }
        async function updateTicker() { const sym = tickerAssets[assetIdx]; if(!isTickerPinned) assetIdx=(assetIdx+1)%tickerAssets.length; document.getElementById('t-sym').textContent=sym; try { const d = await callGateApi("GET", "/spot/tickers", `currency_pair=${sym}_USDT`); if(d&&d[0]) { document.getElementById('t-price').textContent=parseFloat(d[0].last).toFixed(4); document.getElementById('t-dot').classList.toggle('pulse'); } } catch(e){} }
        
    </script>
</body>
</html>